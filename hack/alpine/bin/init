#!/bin/busybox sh

# install busybox symlinks
/bin/busybox --install -s /bin

# fix any broken symlinks.
# this shouldn't be necessary, but some symlinks
# end up pointing to nothing. perhaps related to issue #175
for link in $(/bin/busybox find /bin -maxdepth 1 -type l); do
  /bin/busybox rm "$link"
  /bin/busybox ln -s "/bin/busybox" "$link"
done

# another needed broken symlink not in bin
rm /usr/lib/libz.so.1
ln -s /usr/lib/libz.so.1.3.1 /usr/lib/libz.so.1

# configure networking
echo "nameserver 8.8.8.8" > /etc/resolv.conf
ifconfig eth0 up
udhcpc -i eth0 -s /bin/post-dhcp

# configure apk
echo 'http://dl-cdn.alpinelinux.org/alpine/v3.21/main' > /etc/apk/repositories
echo 'http://dl-cdn.alpinelinux.org/alpine/v3.21/community' >> /etc/apk/repositories

# start shell
setsid /bin/busybox sh -c "exec /bin/busybox sh </dev/ttyS0 >/dev/ttyS0 2>&1"